apiVersion: v1
kind: ConfigMap
metadata:
  name: event-exporter-cfg
  namespace: monitoring
data:
  config.yaml: |
    logLevel: debug
    logFormat: json
    metricsNamePrefix: event_exporter_
    route:
      routes:
        - match:
            - receiver: "dump"
        - match:
            - namespace: "argocd"
              receiver: "slack"
        - match:
            - kind: "Pod|Deployment|ReplicaSet"
              receiver: "slack"
    receivers:
      - name: "slack"
        slack:
          token: ${SLACK_TOKEN}
          channel: "@{{ .InvolvedObject.Labels.owner }}"
          message: "{{ .Message }}"
          fields:
            namespace: "{{ .Namespace }}"
            reason: "{{ .Reason }}"
            object: "{{ .Namespace }}"
      - name: "slack"
        slack:
          token: ${SLACK_TOKEN}
          channel: "#general"
          message: "{{ .Message }}"
          fields:
            namespace: "{{ .Namespace }}"
            reason: "{{ .Reason }}"
            object: "{{ .Namespace }}"